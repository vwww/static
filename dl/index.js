prepath="http://d.cdn.victorz.ca/d/";animspeed=1E3;currentdir="";currentsort="i";function isNumber(b){return!isNaN(parseFloat(b))&&isFinite(b)}function mkdesc(b){return 0>b?"-":isNumber(b)?(new Date(1E3*b)).format("mmm dd yyyy hh:MM:ss TT"):b}function fsz(b,e){if(0>b)return"-";if(!isNumber(b))return b;p=["","K","M"];m=e?0:p.length-1;for(i=0;i<m&&!(1E3>b);++i)b/=1024;return Math.round(100*b)/100+" "+p[i]+"B"}function mkbreadcrumbs(b){b=b.split("/");ret=['/<a href="#" onclick="return newDir()">root</a>'];cascade="";for(i in b)b[i]&&(cascade&&(cascade+="/"),cascade+=b[i],ret.push('<a href="#'+cascade+'" onclick="return newDir(\''+cascade+"')\">"+b[i]+"</a>"));return ret.join("/")+"/"}function up1(b){return b.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,"").replace(/^\/+/g,"")}function geti(b){if("d"==b.t)return"//p.cdn.victorz.ca/dl/i/folder"+(b.s&&1337!=b.i?"":2)+".png";if("r"==b.t||"l"==b.t)return"//p.cdn.victorz.ca/dl/i/link.png";if("f"!=b.t)return"//p.cdn.victorz.ca/dl/i/unknown.png";ext=b.i.split(".").slice(-1)[0];img="unknown";switch(ext){case "jpg":case "jpeg":case "bmp":img="jpg";break;case "zip":case "rar":case "gz":img="archive";break;case "txt":img="text";break;case "htm":case "html":img="html";break;case "xls":case "xlsx":img="xls";break;case "doc":case "docx":img="doc";break;case "mpg":case "mpeg":case "mov":case "avi":img="video";break;case "gm6":case "gmk":img="gm";break;case "js":case "vbs":img="script";break;case "png":case "gif":case "exe":case "fla":case "swf":case "sig":case "pdf":case "psd":case "rm":case "eps":case "css":img=ext}return"//p.cdn.victorz.ca/dl/i/"+img+".png"}function fetchListing(){$.getJSON(prepath+"list.php?d="+currentdir+"&s="+currentsort+"&callback=?",function(b){currentdir=b.p;b.s&&(currentsort=b.s);$("#breadcrumbpath").html(mkbreadcrumbs(b.p));$("#breadcrumbsz").text(fsz(b.c));$("#breadcrumbsz").attr("title",fsz(b.c,!0));$(".headersortable").css({"font-weight":"normal","text-decoration":"none"});$("#header-"+currentsort.toLowerCase()).css({"font-weight":900,"text-decoration":currentsort==currentsort.toUpperCase()?"overline":"underline"});sorts=["i","s","r"];for(i in sorts)$("#sort-"+sorts[i]).attr("src","//p.cdn.victorz.ca/dl/i/"+(sorts[i]==currentsort.toLowerCase()?(currentsort==currentsort.toUpperCase()?"s_d":"s_a")+".png":"trans.gif"));$("#roots").text(fsz(b.t));$("#roots").attr("title",fsz(b.t,!0));$("#ups").text(fsz(b.a));$("#ups").attr("title",fsz(b.a,!0));$("#rootl").text(mkdesc(b.m));$("#now").text((new Date).getFullYear());$("#usize").text(fsz(b.u));b.u?($("#upload").show(animspeed),$("#uploadbtn").removeAttr("disabled")):($("#upload").hide(animspeed),$("#uploadbtn").attr("disabled","disabled"));b=b.l;$("#listing").children().each(function(b,f){2<=b&&$(f).hide(0.7*animspeed,function(){$(this).remove()})});e_up=$(".up");"/"==currentdir?e_up.hide(0.7*animspeed):e_up.show(animspeed);e_up.attr("href","#"+up1(currentdir));c=!1;for(i in b){callback='onclick="';d=b[i];n=d.i;s=d.s;r=d.r;switch(d.t){case "r":callback='href="'+d.i;break;case "l":callback='href="'+d.r;break;case "d":callback+="return newDir('"+currentdir+"/"+d.i+"')\"";callback+='href="#'+currentdir.substring(1)+(1<currentdir.length?"/":"")+d.i;break;case "f":target=prepath+"get.php?d="+currentdir+"&f="+d.i;callback+="window.open('"+target+"', '_blank');return false\"";callback+='href="'+target;break;default:n="(unknown) "+n,callback+="return false"}a=$('<div><a class="'+((c=!c)?"b":"w")+'" title="'+n+'" '+callback+'"><img src="'+geti(d)+'" alt="'+n+'" /><strong>'+n+'</strong> <em title="'+fsz(s,!0)+'">'+fsz(s)+"</em> "+mkdesc(r)+"</a></div>");$("#listing").append(a);a.hide().show(animspeed)}})}function newDir(b){currentdir=".."==b?up1(currentdir):b;fetchListing();return!0}function setsorting(b){b=b.toLowerCase();currentsort=currentsort==b?b.toUpperCase():b;fetchListing()}$(function(){document.title="Victor's AJAX Downloads";$(".up,#upload").hide();currentdir=location.hash.substring(1);fetchListing()});